<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ø§Ø³ØªØ¹Ù„Ø§Ù… Ù†ØªØ§Ø¦Ø¬ Ø§Ù„Ø·Ù„Ø§Ø¨</title>
    <!-- ØªØ¶Ù…ÙŠÙ† Tailwind CSS Ù„Ø³Ù‡ÙˆÙ„Ø© Ø§Ù„ØªØµÙ…ÙŠÙ… ÙˆØ§Ù„Ø§Ø³ØªØ¬Ø§Ø¨Ø© -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- ØªØ¶Ù…ÙŠÙ† Font Awesome Ù„Ø£ÙŠÙ‚ÙˆÙ†Ø§Øª Ù…Ø«Ù„ Ø£ÙŠÙ‚ÙˆÙ†Ø© Ø§Ù„ØªÙ„ÙŠØ¬Ø±Ø§Ù… ÙˆØ§Ù„ÙˆØ§ØªØ³Ø§Ø¨ -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css" xintegrity="sha512-SnH5WK+bZxgPHs44uWIX+LLMDJ8uR0Hz55J3c1L/2wXoW0/s0T3fA+Q6U7m42vXk4D7VwV5MvV5N5X7g5E2w==" crossorigin="anonymous" referrerpolicy="no-referrer" />
    <!-- Ù…ÙƒØªØ¨Ø© Confetti Ù„ØªØ£Ø«ÙŠØ± Ø§Ù„ÙØ±Ù‚Ø¹Ø© Ø¹Ù†Ø¯ Ø¸Ù‡ÙˆØ± Ø§Ù„Ù†ØªÙŠØ¬Ø© -->
    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.9.3/dist/confetti.browser.min.js"></script>
    <style>
        /* Ø¥Ø¶Ø§ÙØ© Ø®Ø· Ø¹Ø±Ø¨ÙŠ Ø¹ØµØ±ÙŠ */
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@100..900&display=swap');
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f3f4f6;
        }

        /* --- Ø¥Ø®ÙØ§Ø¡ Ø£Ø³Ù‡Ù… Ø­Ù‚Ù„ Ø§Ù„Ø¥Ø¯Ø®Ø§Ù„ (Spin Buttons) --- */
        /* Ù„Ù…ØªØµÙØ­Ø§Øª Chrome, Safari, Edge, Opera */
        input::-webkit-outer-spin-button,
        input::-webkit-inner-spin-button {
            -webkit-appearance: none;
            margin: 0;
        }
        /* Ù„Ù…ØªØµÙØ­ Firefox */
        input[type=number] {
            -moz-appearance: textfield;
        }
    </style>
</head>
<body class="min-h-screen flex items-center justify-center p-4">

    <!-- Ø§Ù„Ø­Ø§ÙˆÙŠØ© Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ© Ù„Ù„ÙˆØ§Ø¬Ù‡Ø© -->
    <div class="w-full max-w-md bg-white shadow-2xl rounded-xl p-8 space-y-6">

        <!-- Ù‚Ø³Ù… Ø§Ù„Ø¹Ù†ÙˆØ§Ù† ÙˆØ§Ù„ÙˆØµÙ (ØªÙ… Ø­Ø°Ù Ø§Ù„Ø¥Ù…Ø¶Ø§Ø¡ Ù…Ù† Ù‡Ù†Ø§) -->
        <div class="text-center space-y-2">
            <h1 id="main-title" class="text-2xl font-bold text-gray-800">Ø§Ø¹Ø±Ù ØªØ±ØªÙŠØ¨Ùƒ Ø¹Ù„Ù‰ Ø§Ù„Ø¯ÙØ¹Ø©</h1>
            <p id="main-description" class="text-sm text-gray-500">
                Ø£Ø¯Ø®Ù„ Ø±Ù‚Ù… Ø§Ù„Ø¬Ù„ÙˆØ³ Ù„Ù„Ø§Ø³ØªØ¹Ù„Ø§Ù….
            </p>
        </div>

        <!-- Ù†Ù…ÙˆØ°Ø¬ Ø§Ù„Ø¥Ø³ØªØ¹Ù„Ø§Ù… (Query Form) -->
        <div id="query-section" class="space-space-y-4">
            <label for="seat-number" class="block text-sm font-medium text-gray-700">Ø±Ù‚Ù… Ø§Ù„Ø¬Ù„ÙˆØ³ (ID)</label>
            <input type="number" id="seat-number" placeholder="ØµÙ„ÙŠ Ø¹Ù„ÙŠ Ø§Ù„Ù†Ø¨ÙŠ" required
                   class="w-full p-3 border border-gray-300 rounded-lg focus:ring-blue-500 focus:border-blue-500 text-lg text-center">
            
            <button id="search-button" onclick="checkResult()"
                    class="w-full bg-blue-600 text-white p-3 rounded-lg font-semibold hover:bg-blue-700 transition duration-150 disabled:opacity-50">
                Ø¨Ø­Ø«
            </button>

            <!-- Ø±Ø³Ø§Ù„Ø© Ø§Ù„Ø®Ø·Ø£ (Ù…Ø®ÙÙŠØ©) -->
            <div id="error-message" class="hidden bg-red-100 border border-red-400 text-red-700 px-4 py-3 rounded relative text-sm" role="alert">
                <span class="block sm:inline" id="error-text">Ø§Ù„Ø±Ø¬Ø§Ø¡ Ø¥Ø¯Ø®Ø§Ù„ Ø±Ù‚Ù… Ø¬Ù„ÙˆØ³ ØµØ­ÙŠØ­.</span>
            </div>
            
             <!-- Ø±Ø³Ø§Ù„Ø© Ø§Ù„ØªØ­Ù…ÙŠÙ„ (Ù…Ø®ÙÙŠØ©) -->
            <p id="loading-message" class="hidden text-xs text-center text-gray-500 pt-2">
                Ø¬Ø§Ø±ÙŠ ØªØ­Ù…ÙŠÙ„ Ù…Ù„Ù Ø§Ù„Ù†ØªØ§Ø¦Ø¬ Ù„Ù„Ù…Ø±Ø© Ø§Ù„Ø£ÙˆÙ„Ù‰... Ù‚Ø¯ ÙŠØ³ØªØºØ±Ù‚ Ø§Ù„Ø£Ù…Ø± Ø¨Ø¹Ø¶ Ø§Ù„ÙˆÙ‚Øª.
            </p>
            
             <!-- Ø±Ø³Ø§Ù„Ø© Ø­Ø¯ÙˆØ¯ Ø§Ù„Ø¨Ø­Ø« (Ù…Ø®ÙÙŠØ©) -->
            <div id="limit-message" class="hidden bg-yellow-100 border border-yellow-400 text-yellow-700 px-4 py-3 rounded relative text-sm mt-3" role="alert">
                <span id="limit-text">Ù„Ù‚Ø¯ ÙˆØµÙ„Øª Ù„Ù„Ø­Ø¯ Ø§Ù„Ø£Ù‚ØµÙ‰ Ù„Ù„Ø§Ø³ØªØ¹Ù„Ø§Ù…Ø§Øª Ø§Ù„ÙŠÙˆÙ…ÙŠØ© (8 Ù…Ø­Ø§ÙˆÙ„Ø§Øª). ÙŠØ±Ø¬Ù‰ Ø§Ù„Ù…Ø­Ø§ÙˆÙ„Ø© ØºØ¯Ø§Ù‹.</span>
            </div>
        </div>

        <!-- Ù‚Ø³Ù… Ø¹Ø±Ø¶ Ø§Ù„Ù†ØªØ§Ø¦Ø¬ (Result Display) -->
        <div id="result-section" class="hidden space-y-4 pt-4 border-t border-gray-200">
            <div class="bg-white p-6 rounded-lg shadow-inner text-center space-y-4">
                
                <!-- Ø§Ø³Ù… Ø§Ù„Ø·Ø§Ù„Ø¨ (ÙŠØ¨Ù‚Ù‰ Ù„Ù„Ø¹Ø±Ø¶ Ø§Ù„Ø£Ø³Ø§Ø³ÙŠ) -->
                <h2 id="student-name" class="text-xl font-bold text-gray-800 border-b pb-2"></h2>

                <!-- Ø­Ù‚ÙˆÙ„ Ø§Ù„ØªØ±ØªÙŠØ¨ ÙˆØ§Ù„Ù†Ø³Ø¨Ø© Ø§Ù„Ù…Ø¦ÙˆÙŠØ© -->
                <div class="grid grid-cols-2 gap-4">
                    
                    <!-- Ø­Ù‚Ù„ Ø§Ù„ØªØ±ØªÙŠØ¨ (ØªÙ… Ù†Ù‚Ù„Ù‡ Ù„Ù„ÙŠÙ…ÙŠÙ†) -->
                    <div class="p-3 rounded-lg bg-yellow-100 shadow-md">
                        <p class="text-xs font-medium text-yellow-700 mb-1">Ø§Ù„ØªØ±ØªÙŠØ¨:</p>
                        <p id="student-rank" class="text-2xl font-extrabold text-yellow-800"></p>
                    </div>

                    <!-- Ø­Ù‚Ù„ Ø§Ù„Ù†Ø³Ø¨Ø© Ø§Ù„Ù…Ø¦ÙˆÙŠØ© (ØªÙ… Ù†Ù‚Ù„Ù‡ Ù„Ù„ÙŠØ³Ø§Ø±) -->
                    <div class="p-3 rounded-lg bg-green-100 shadow-md">
                        <p class="text-xs font-medium text-green-700 mb-1">Ø§Ù„Ù†Ø³Ø¨Ø© Ø§Ù„Ù…Ø¦ÙˆÙŠØ©:</p>
                        <p id="student-percentage" class="text-2xl font-extrabold text-green-800"></p>
                    </div>

                </div>

                <!-- Ø±Ø³Ø§Ù„Ø© ØªÙ‡Ù†Ø¦Ø© Ø§Ø­ØªÙØ§Ù„ÙŠØ© -->
                <p class="text-xl font-extrabold text-blue-600 pt-3">Ø£Ù„Ù Ù…Ø¨Ø±ÙˆÙƒ ğŸ¥³â¤ï¸â¤ï¸</p>
                <p id="congrats-message" class="text-sm text-gray-500 pt-1">
                    ØªØ§Ø¨Ø¹ÙˆØ§ Ø¢Ø®Ø± Ø§Ù„Ø£Ø®Ø¨Ø§Ø± ÙˆØ§Ù„Ù†ØµØ§Ø¦Ø­ Ù„Ù„Ù…Ø±Ø§Ø­Ù„ Ø§Ù„Ù‚Ø§Ø¯Ù…Ø©!
                </p>
                
                <!-- Ø§Ù„Ø¥Ù…Ø¶Ø§Ø¡ (ØªÙ… Ù†Ù‚Ù„Ù‡ Ø¥Ù„Ù‰ Ù‡Ù†Ø§) -->
                <p class="text-xs font-medium text-gray-400 text-center pt-4 pb-2 leading-none">
                    Ø¹Ø¨Ø¯Ø§Ù„Ø±Ø­Ù…Ù† Ø±Ø¬Ø¨ Batch 1
                </p>

                <!-- Ø²Ø± Ù‚Ù†Ø§Ø© Ø§Ù„ØªÙ„ÙŠØ¬Ø±Ø§Ù… -->
                <a href="https://t.me/Abdelrahman_Ragab1" target="_blank"
                   class="inline-flex items-center justify-center w-full p-3 text-white bg-sky-500 rounded-lg font-semibold hover:bg-sky-600 transition duration-150 shadow-lg shadow-sky-200 mb-2">
                    <i class="fab fa-telegram-plane ml-2 text-xl"></i>
                    Ø§Ù†Ø¶Ù… Ù„Ù‚Ù†Ø§Ø© Ø§Ù„ØªÙ„ÙŠØ¬Ø±Ø§Ù… Ø§Ù„Ø®Ø§ØµØ© Ø¨Ù†Ø§
                </a>
                
                <!-- Ø²Ø± Ù…Ø¬Ù…ÙˆØ¹Ø© Ø§Ù„ÙˆØ§ØªØ³Ø§Ø¨ Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø© -->
                <!-- ØªÙ… ØªØ­Ø¯ÙŠØ« Ø±Ø§Ø¨Ø· ÙˆÙ…Ø³Ù…Ù‰ Ø§Ù„ÙØ±Ù‚Ø© Ù‡Ù†Ø§ Ø¥Ù„Ù‰ "ÙØ±Ù‚Ø© Ø«Ø§Ù„Ø«Ø©" -->
                <a href="https://chat.whatsapp.com/L8d0c706CeEDiRFlys6rTD" target="_blank"
                   class="inline-flex items-center justify-center w-full p-3 text-white bg-green-500 rounded-lg font-semibold hover:bg-green-600 transition duration-150 shadow-lg shadow-green-200">
                    <i class="fab fa-whatsapp ml-2 text-xl"></i>
                    Ø¬Ø±ÙˆØ¨ "Ø³Ø§Ø¹Ø¯ ÙØªØ³Ø¹Ø¯" (ÙØ±Ù‚Ø© Ø«Ø§Ù„Ø«Ø©)
                </a>
            </div>

            <!-- Ø²Ø± Ø§Ù„Ø¹ÙˆØ¯Ø© -->
            <button onclick="resetApp()" class="w-full text-blue-600 font-semibold text-center hover:text-blue-800 transition duration-150 mt-4">
                Ø§Ù„Ø¹ÙˆØ¯Ø© Ù„Ù„ØµÙØ­Ø© Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ© (Ø§Ø³ØªØ¹Ù„Ø§Ù… Ø¬Ø¯ÙŠØ¯)
            </button>
        </div>
    </div>

    <!-- ÙƒÙˆØ¯ JavaScript Ù„Ù„Ø±Ø¨Ø· Ø¨Ù€ Google Sheets ÙˆØ¥Ø¯Ø§Ø±Ø© Ø­Ø¯ÙˆØ¯ Ø§Ù„Ø¨Ø­Ø« -->
    <script>
        // *************** Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Google Sheets ***************
        // ØªÙ… ØªØ­Ø¯ÙŠØ« Ù…Ø¹Ø±Ù Ø§Ù„Ø´ÙŠØª (SPREADSHEET_ID)
        const SPREADSHEET_ID = '1f3DxNf5xl4MKjKg7DQRi1ElReahayceZZdjTOX-Kc9A';
        const SPREADSHEET_URL = `https://docs.google.com/spreadsheets/d/${SPREADSHEET_ID}/gviz/tq?tqx=out:json`;
        
        // *************** Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø­Ø¯ÙˆØ¯ Ø§Ù„Ø¨Ø­Ø« ***************
        const MAX_SEARCHES = 8;
        const SEARCH_KEY = 'dailySearchCount';
        const TIMESTAMP_KEY = 'lastSearchTimestamp';

        let allResults = [];
        let isDataLoaded = false;
        
        // Ø§Ù„Ù…ØªØºÙŠØ±Ø§Øª Ø§Ù„Ø®Ø§ØµØ© Ø¨Ø§Ù„ÙˆØ§Ø¬Ù‡Ø©
        const seatNumberInput = document.getElementById('seat-number');
        const searchButton = document.getElementById('search-button');
        const querySection = document.getElementById('query-section');
        const resultSection = document.getElementById('result-section');
        const errorMessage = document.getElementById('error-message');
        const loadingMessage = document.getElementById('loading-message');
        const limitMessage = document.getElementById('limit-message');

        // Ø¹Ù†Ø§ØµØ± Ø§Ù„Ø¹Ù†ÙˆØ§Ù† Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©
        const mainTitle = document.getElementById('main-title');
        const mainDescription = document.getElementById('main-description');

        // --- Ø¯Ø§Ù„Ø© Ø¥Ø¯Ø§Ø±Ø© Ø­Ø¯ÙˆØ¯ Ø§Ù„Ø¨Ø­Ø« Ø§Ù„ÙŠÙˆÙ…ÙŠØ© ---
        function checkSearchLimit() {
            const count = parseInt(localStorage.getItem(SEARCH_KEY) || '0');
            const timestamp = parseInt(localStorage.getItem(TIMESTAMP_KEY) || '0');
            const now = Date.now();
            const oneDay = 24 * 60 * 60 * 1000; // 24 Ø³Ø§Ø¹Ø© Ø¨Ø§Ù„Ù…Ù„Ù„ÙŠ Ø«Ø§Ù†ÙŠØ©

            // Ø¥Ø°Ø§ Ù…Ø± 24 Ø³Ø§Ø¹Ø© Ø¹Ù„Ù‰ Ø£ÙˆÙ„ Ø¹Ù…Ù„ÙŠØ© Ø¨Ø­Ø«ØŒ ÙŠØªÙ… ØªØµÙÙŠØ± Ø§Ù„Ø¹Ø¯Ø§Ø¯
            if (now - timestamp > oneDay) {
                localStorage.setItem(SEARCH_KEY, '0');
                localStorage.setItem(TIMESTAMP_KEY, now.toString()); // ØªØ­Ø¯ÙŠØ« Ø§Ù„ÙˆÙ‚Øª Ø¹Ù†Ø¯ Ø§Ù„ØªØµÙÙŠØ±
                limitMessage.classList.add('hidden');
                return true; // Ù…Ø³Ù…ÙˆØ­ Ø¨Ø§Ù„Ø¨Ø­Ø«
            }

            if (count >= MAX_SEARCHES) {
                searchButton.disabled = true;
                limitMessage.classList.remove('hidden');
                return false; // ØºÙŠØ± Ù…Ø³Ù…ÙˆØ­ Ø¨Ø§Ù„Ø¨Ø­Ø«
            }
            
            limitMessage.classList.add('hidden');
            return true; // Ù…Ø³Ù…ÙˆØ­ Ø¨Ø§Ù„Ø¨Ø­Ø«
        }

        // ØªØ³Ø¬ÙŠÙ„ Ù…Ø­Ø§ÙˆÙ„Ø© Ø¨Ø­Ø« Ù†Ø§Ø¬Ø­Ø©
        function recordSearchAttempt() {
            let count = parseInt(localStorage.getItem(SEARCH_KEY) || '0');
            let timestamp = parseInt(localStorage.getItem(TIMESTAMP_KEY) || '0');
            const now = Date.now();
            
            if (timestamp === 0) {
                 // Ø¥Ø°Ø§ ÙƒØ§Ù†Øª Ø£ÙˆÙ„ Ù…Ø­Ø§ÙˆÙ„Ø© ÙÙŠ Ø¯ÙˆØ±Ø© 24 Ø³Ø§Ø¹Ø©
                 localStorage.setItem(TIMESTAMP_KEY, now.toString());
            }
            
            count++;
            localStorage.setItem(SEARCH_KEY, count.toString());
        }

        // Ø¯Ø§Ù„Ø© Ø¥Ø·Ù„Ø§Ù‚ ØªØ£Ø«ÙŠØ± Ø§Ù„ÙØ±Ù‚Ø¹Ø© (Confetti)
        function launchConfetti() {
            if (window.confetti) {
                // Ø¥Ø·Ù„Ø§Ù‚ Ø¯ÙØ¹Ø© Ù‚ÙˆÙŠØ© Ù…Ù† Ø§Ù„Ø£Ø¹Ù„Ù‰
                confetti({
                    particleCount: 200,
                    spread: 100,
                    origin: { y: 0.6 }
                });
                // Ø¥Ø·Ù„Ø§Ù‚ Ø¯ÙØ¹ØªÙŠÙ† Ù…Ù† Ø§Ù„Ø¬Ø§Ù†Ø¨ÙŠÙ† Ù„Ù…Ù„Ø¡ Ø§Ù„Ø´Ø§Ø´Ø©
                confetti({
                    particleCount: 100,
                    angle: 60,
                    spread: 80,
                    origin: { x: 0 }
                });
                confetti({
                    particleCount: 100,
                    angle: 120,
                    spread: 80,
                    origin: { x: 1 }
                });
            }
        }

        // Ø¯Ø§Ù„Ø© Ù„Ø¬Ù„Ø¨ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ù…Ù† Google Sheets
        async function fetchResultsFromSheet() {
            loadingMessage.classList.remove('hidden');
            searchButton.disabled = true;

            try {
                let response;
                let attempts = 0;
                const maxAttempts = 3;

                while (attempts < maxAttempts) {
                    try {
                        response = await fetch(SPREADSHEET_URL);
                        if (response.ok) break;
                        
                        if (attempts < maxAttempts - 1) {
                            await new Promise(resolve => setTimeout(resolve, 1000 * Math.pow(2, attempts)));
                        }
                    } catch (e) {
                         if (attempts < maxAttempts - 1) {
                            await new Promise(resolve => setTimeout(resolve, 1000 * Math.pow(2, attempts)));
                        } else {
                             throw e;
                        }
                    }
                    attempts++;
                }

                if (!response || !response.ok) {
                    throw new Error(`HTTP error! status: ${response ? response.status : 'Network Failed'}`);
                }
                
                const text = await response.text();
                
                const jsonText = text.substring(text.indexOf('{'), text.lastIndexOf('}') + 1);
                const data = JSON.parse(jsonText);
                
                if (data.table && data.table.rows) {
                    allResults = data.table.rows.map(row => {
                        
                        const seatNumberData = row.c[0];
                        const nameData = row.c[1];
                        const percentageData = row.c[2];
                        const rankData = row.c[3];

                        const seatNumber = seatNumberData ? seatNumberData.v : null;
                        const name = nameData ? nameData.v : 'ØºÙŠØ± Ù…Ø¹Ø±ÙˆÙ';

                        let percentageValue = 'N/A';
                        if (percentageData && percentageData.v !== null) {
                             // Ø§Ù„ØªØ¹Ø§Ù…Ù„ Ù…Ø¹ Ø§Ù„Ø£Ø±Ù‚Ø§Ù… Ø§Ù„Ø¹Ø´Ø±ÙŠØ© (Ù…Ø«Ù„Ø§Ù‹ 0.95)
                            percentageValue = (parseFloat(percentageData.v) * 100).toFixed(2);
                        } else if (percentageData && percentageData.f) {
                            // Ø§Ù„ØªØ¹Ø§Ù…Ù„ Ù…Ø¹ Ø§Ù„Ù‚ÙŠÙ… Ø§Ù„Ù…Ù†Ø³Ù‚Ø© ÙƒÙ†Øµ (Ù…Ø«Ù„Ø§Ù‹ "95.00%")
                             percentageValue = percentageData.f.replace('%', '').trim();
                        }
                        const percentage = `${percentageValue}%`;
                        
                        const rank = rankData ? rankData.v : 'N/A';
                        
                        return { seatNumber: String(seatNumber), name, percentage, rank: String(rank) }; 
                    }).filter(r => r.seatNumber !== 'null');

                    isDataLoaded = true;
                    console.log(`Successfully loaded ${allResults.length} records from Google Sheet.`);
                } else {
                    throw new Error("Invalid data structure received from Google Sheet.");
                }

            } catch (error) {
                console.error("Error fetching or parsing Google Sheet data:", error);
                document.getElementById('error-text').textContent = 'Ø¹Ø°Ø±Ø§Ù‹ØŒ Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ ØªØ­Ù…ÙŠÙ„ Ù…Ù„Ù Ø§Ù„Ù†ØªØ§Ø¦Ø¬. (ØªØ£ÙƒØ¯ Ù…Ù† Ø§Ù„Ø±Ø§Ø¨Ø· ÙˆØ§Ù„Ù†Ø´Ø±).';
                errorMessage.classList.remove('hidden');
                isDataLoaded = false;
            } finally {
                loadingMessage.classList.add('hidden');
                updateSearchButtonState();
            }
        }

        // Ø¯Ø§Ù„Ø© ÙØ­Øµ ÙˆØ¹Ø±Ø¶ Ø§Ù„Ù†ØªÙŠØ¬Ø©
        window.checkResult = async () => {
            if (!checkSearchLimit()) return; // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„Ø­Ø¯ Ø§Ù„Ø£Ù‚ØµÙ‰ Ù‚Ø¨Ù„ Ø§Ù„Ø¨Ø¯Ø¡

            const id = seatNumberInput.value.trim();
            errorMessage.classList.add('hidden');
            searchButton.disabled = true;
            searchButton.textContent = '... Ø¬Ø§Ø±ÙŠ Ø§Ù„Ø¨Ø­Ø«';

            if (!id) {
                document.getElementById('error-text').textContent = 'Ø§Ù„Ø±Ø¬Ø§Ø¡ Ø¥Ø¯Ø®Ø§Ù„ Ø±Ù‚Ù… Ø§Ù„Ø¬Ù„ÙˆØ³ Ø£ÙˆÙ„Ø§Ù‹.';
                errorMessage.classList.remove('hidden');
                searchButton.textContent = 'Ø¨Ø­Ø«';
                updateSearchButtonState();
                return;
            }

            if (!isDataLoaded) {
                await fetchResultsFromSheet();
                if (!isDataLoaded) {
                     searchButton.textContent = 'Ø¨Ø­Ø«';
                     return;
                }
            }
            
            const student = allResults.find(s => s.seatNumber === String(id));

            if (student) {
                // ØªØ³Ø¬ÙŠÙ„ Ù…Ø­Ø§ÙˆÙ„Ø© Ø§Ù„Ø¨Ø­Ø« Ø§Ù„Ù†Ø§Ø¬Ø­Ø©
                recordSearchAttempt();
                
                // Ø¹Ø±Ø¶ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø·Ø§Ù„Ø¨
                document.getElementById('student-name').textContent = student.name;
                document.getElementById('student-percentage').textContent = student.percentage;
                document.getElementById('student-rank').textContent = student.rank;
                
                // Ø¥Ø®ÙØ§Ø¡ Ø§Ù„Ø¹Ù†ÙˆØ§Ù† ÙˆØ§Ù„ÙˆØµÙ Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠ Ø¹Ù†Ø¯ Ø¸Ù‡ÙˆØ± Ø§Ù„Ù†ØªÙŠØ¬Ø©
                mainTitle.classList.add('hidden');
                mainDescription.classList.add('hidden');

                // ØªØ¨Ø¯ÙŠÙ„ Ø§Ù„Ø£Ù‚Ø³Ø§Ù…
                querySection.classList.add('hidden');
                resultSection.classList.remove('hidden');

                // Ø¥Ø·Ù„Ø§Ù‚ ØªØ£Ø«ÙŠØ± Ø§Ù„ÙØ±Ù‚Ø¹Ø© Ù„Ù„Ø§Ø­ØªÙØ§Ù„
                launchConfetti();

            } else {
                // Ø­Ø§Ù„Ø© Ø¹Ø¯Ù… Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ Ø§Ù„Ø·Ø§Ù„Ø¨ - Ù„Ø§ ØªØ³Ø¬Ù„ ÙƒÙ…Ø­Ø§ÙˆÙ„Ø© (Ù„ØªØ´Ø¬ÙŠØ¹ Ø§Ù„Ù…Ø­Ø§ÙˆÙ„Ø© Ø§Ù„ØµØ­ÙŠØ­Ø©)
                document.getElementById('error-text').textContent = `Ø¹Ø°Ø±Ø§Ù‹ØŒ Ù„Ù… ÙŠØªÙ… Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ Ù†ØªØ§Ø¦Ø¬ Ù„Ø±Ù‚Ù… Ø§Ù„Ø¬Ù„ÙˆØ³ ${id}. Ø§Ù„Ø±Ø¬Ø§Ø¡ Ø§Ù„ØªØ£ÙƒØ¯ Ù…Ù† Ø§Ù„Ø±Ù‚Ù… ÙˆØ§Ù„Ù…Ø­Ø§ÙˆÙ„Ø© Ù…Ø±Ø© Ø£Ø®Ø±Ù‰.`;
                errorMessage.classList.remove('hidden');
            }
            
            searchButton.textContent = 'Ø¨Ø­Ø«';
            updateSearchButtonState();
        }

        // Ø¯Ø§Ù„Ø© ØªØ­Ø¯ÙŠØ« Ø­Ø§Ù„Ø© Ø²Ø± Ø§Ù„Ø¨Ø­Ø«
        function updateSearchButtonState() {
            // ÙŠØªÙ… ØªÙØ¹ÙŠÙ„ Ø§Ù„Ø²Ø± Ø¥Ø°Ø§ ÙƒØ§Ù†Øª Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ù‚Ø¯ Ø­Ù…Ù„Øª ÙˆÙƒØ§Ù†Øª Ù‡Ù†Ø§Ùƒ Ù‚ÙŠÙ…Ø© ÙÙŠ Ø­Ù‚Ù„ Ø§Ù„Ø¥Ø¯Ø®Ø§Ù„ ÙˆÙ„Ù… ÙŠØªÙ… ØªØ¬Ø§ÙˆØ² Ø§Ù„Ø­Ø¯
            searchButton.disabled = seatNumberInput.value.length === 0 || !isDataLoaded || !checkSearchLimit();
        }

        // Ø¯Ø§Ù„Ø© Ø¥Ø¹Ø§Ø¯Ø© ØªØ¹ÙŠÙŠÙ† Ø§Ù„ØªØ·Ø¨ÙŠÙ‚ Ù„Ù„Ø§Ø³ØªØ¹Ù„Ø§Ù… Ø§Ù„Ø¬Ø¯ÙŠØ¯
        window.resetApp = () => {
            seatNumberInput.value = '';
            searchButton.disabled = true;
            errorMessage.classList.add('hidden');
            
            // Ø¥Ø¸Ù‡Ø§Ø± Ø§Ù„Ø¹Ù†ÙˆØ§Ù† ÙˆØ§Ù„ÙˆØµÙ Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠ Ø¹Ù†Ø¯ Ø§Ù„Ø¹ÙˆØ¯Ø©
            mainTitle.classList.remove('hidden');
            mainDescription.classList.remove('hidden');

            querySection.classList.remove('hidden');
            resultSection.classList.add('hidden');
            updateSearchButtonState();
        }

        // Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯ Ø¹Ù†Ø¯ ØªØ­Ù…ÙŠÙ„ Ø§Ù„ØµÙØ­Ø©
        window.onload = () => {
            seatNumberInput.addEventListener('input', updateSearchButtonState);
            // Ø§Ø¨Ø¯Ø£ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª ÙÙˆØ±Ù‹Ø§ Ø¹Ù†Ø¯ ØªØ­Ù…ÙŠÙ„ Ø§Ù„ØµÙØ­Ø© ÙˆØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„Ø­Ø¯ Ø§Ù„Ø£Ù‚ØµÙ‰
            fetchResultsFromSheet(); 
            checkSearchLimit();
        };
    </script>

</body>
</html>
